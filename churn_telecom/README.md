# Прогнозирование оттока клиента

---

## Описание проекта

Оператор связи хочет научиться прогнозировать отток клиентов. Если выяснится, что пользователь планирует уйти, ему будут предложены промокоды и специальные условия.  

Команда оператора собрала персональные данные о некоторых клиентах, информацию об их тарифах и договорах.

Заказчик имеет долгосрочную стратегию развития и расширения зоны предоставления услуг.

---

### Бизнес-проблематика

Уточнили у заказчика бизнес-метрики и проблематику.  

Сейчас это убытки, связанные с неэффективными акциями по удержанию клиентов с помощью промо-купонов, скидок и прочих пакетов стимулирования.  

Маркетологи компании выделяют две болевые точки:

+ Пользователю предложили промокоды, но он не собирался уходить (классический пример False Positive на нашем языке);
+ Пользователю ничего не предложили и он ушёл (как говорится, False Negative).

Помимо loss-метрики ROC-AUC для нас, заказчик хочет какую-нибудь интерпретируемую метрику, чтобы руководство могло понять отчет. Будем использовать метрику качества accuracy и приведем матрицу ошибок для убедительного отчета

---

Мы проделали большую работу для решения задачи предсказания отточных клиентов, а именно:
+ Поняли и оценили задачу
  + Необходимо предсказать отточных пользователей с минимизацией ошибки второго рода то есть получить меньше всего ошибок на пользователях, которые ушли, а предсказание говорило об обратном
  + Главной болью заказчика является убытки связанные с неэффективными акциями по удержанию клиентов с помощью промо-купонов, скидок и прочих пакетов стимулирования
  + Выделены две болевые точки:
    + пользователю предложили промокоды, но он не собирался уходить (False Positive)
    + пользователю ничего не предложили и он ушёл (False Negative)
  + Определелили метрику для минимизации ошибки - ROC-AUC  
  + Также определили интерпретируемую метрику для заказчика - accuracy
+ Изучили данные
  + Выяснили, что выгруженные данные различаются по размеру выборок
  + Большинство признаков бинарные категориальные, также есть 2 признака с большим числом категорий
  + Были найдены ошибки выгрузки/сбора данных, а также работы предыдущей команды разработки
+ Предобработали данные
  + Объединили выборки в один датасет
  + Создали целевой признак отточности пользователей на основе признака даты окончания пользования услугами
  + Создали на основе двух неинформативных признаков дат новый признак продолжительность пользования услугами компании
  + В дальнейшем исключили эти два признака при обучении модели, так как они позволяют подглядеть в целевой признак
  + Исправили найденные ошибки на этапе осмотра данных
  + Заполнили пропуски в данных полученные после объединения разных по размеру выборок(приняли отсутствие пользователя в выборке за неиспользование услуги и проставили маркер 'No')
+ Провели исследование данных и выяснили:
  + Большинство услуг не используется пользователями, можем посоветовать пересмотреть условия по ним или сами услуги (возможно в этом и есть убыточность)
  + Пользователи по половому признаку и наличию партнера присутствуют примерно в равных количествах
  + Выделили два пика прихода пользователей в 2014 и 2019 году:
    + В первом случае были пиковые оплаты в связи с двухгодовой подпиской
    + Во втором большой приток пользователей был с подпиской на месяц (много пользователей, маленькое среднее значение общих оплат)
  + Провели анализ распределения средних значений суммарных платежей по пользователям, которые пользуются дополнительными сервисами
    +  Пользователи с интернет-сервисом DSL, не использующие сервисы потокового просмотра фильмов и телевидения, имеют самые низкие средние общие платежи (среднее: 1152.83) среди всех групп.
    + Пользователи с интернет-сервисом Fiber optic, которые используют оба сервиса потокового просмотра фильмов и телевидения, имеют самые высокие средние общие платежи (среднее: 4144.88) среди всех групп.
    + Пользователи с интернет-сервисом Fiber optic в целом имеют более высокие средние общие платежи по сравнению с пользователями DSL.
    + Группа с маркерами в столбцах 'internet_service', 'streaming_movies' и 'streaming_tv' (No) имеет самые низкие средние общие платежи (среднее: 626.98) по сравнению с другими группами с указанными услугами.
    + Эти наблюдения указывают на то, что тип интернет-сервиса и использование потоковых сервисов могут влиять на средние общие платежи пользователей.
    + Пользователи с интернет-сервисом Fiber optic, которые используют оба потоковых сервиса, имеют самые высокие платежи, в то время как пользователи с пропущенной информацией имеют самые низкие платежи в среднем.
  + Отточные пользователи чаще являются клиентами компании более  2-х с половиной лет (~915 дней)  
  + Отток пользователей с 2014 года только падает а новые пользователи растут
  + Определили описание среднего клиента компании:
    - Распределение пользователей по половому признаку примерно одинаково, также как и наличие партнера, так что это человек любого пола
    - Большинство - не пенсионеры и не имеют никого на иждивении
    - Основная часть пользователей используют оптоволокно, чуть меньше  пользователей подключены по DSL
    - Оплата помесячная
    - Получают счет за услуги на электронную почту и оплата в онлайн
    - Большая часть пользователей не пользуется дополнительными услугами компании
+ Исследовали модели
  + Разбили данные на выборки тренировочную (0.75% от исходной) и тестовую (0.25%)
  + Выделили необходимые признаки (дополнительно отделили категориальные признаки и целевой признак для преобразования в моделях)
  + Обучили бейзлайн модель - LogisicRegression
    + Подготовили признаки для модели с помощью конвейера (OHE для категориальных признаков, MinMaxScaler для непрерывных)
    + Перебрали параметры и сохранили лучшие
    + Получили метрики на кросс-валидации:
      + ROC-AUC = 0.77 - взяли это значение за порог, ниже которого метрики других моделей не будут иметь смысла
  + Обучили вторую модель - RandomForestClassifier
    + Подготовили признаки также с помощью конвейера (OrdinalEncoder для категориальных признаков, MinMaxScaler для непрерывных)
    + Перебрали параметры и также сохранили лучшие
    + Получили метрики на кросс-валидации:
      + ROC-AUC =  0.84 - что превзошло бейзлайн, но не дошло до порогового значения функции потерь
  + Обучили третью модель - CatBoostClassifier
    + Для этой модели нет необходимости делать какую либо предобработку, внутри она делает все сама и достаточно хорошо
    + Перебрали параметры на кросс-валидации
    + Получили метрику
      + ROC-AUC = 0.91 - что является лучшей метрикой в нашем исследовании
  + Занесли полученные данные исследования в таблицу результатов и выяснили
    + CatBoostClassifier - лучшая модель ее мы будем тестировать на тестовых данных, которых она еще не видела, чтобы оценить непредвзятое качество
    + CatBoostClassifier На 18.05 % превзошла бейзлайн-модель LogisticRegression
  + Провели тестирование модели и получили метрики:
    + ROC_AUC score: 0.918
    + Accuracy score: 0.897
  + Провели анализ модели
    + Разработали графики
      + Важности ошибок и выявили признаки которые влияли на обучение модели больше всего, а также предлагаем дополнительное исследования для повышения качества предсказаний
        + для модели самыми важными признаками является:
          + продолжительность пользования услугами компании
          + общие траты пользователя
          + помесячные траты
          + тип подписки
          + тип оплаты
          + есть ли партнер
          + Остальные менее значимые, но также сыграли свою роль в предсказании и это с учетом исключения нескольких признаков, также можно провести дополнительное исследование со всеми признаками и дополнительно посмотреть прямое влияние признаков на предсказание с помощью библиотеки shap
      + Построили ROC-кривую
        + ROC-AUC равен 0.918, что говорит о том, что модель обладает высокой способностью разделять классы и имеет хорошие характеристики разделения между классами. Это позволяет довольно точно определить, когда модель делает верные и ложные предсказания, что подтверждается значительной площадью под кривой ROC
        + Точки стремятся к левому верхнему углу, что является хорошим знаком
      + Привели матрицу ошибок
        + Получились достаточно маленькие ошибки, но также есть куда стремится
        + Модель предложила дать промокоды пользователям, которые не собирались уходить 111 раз (False Positive), на тестовой выборке (1761 наблюдение), которую она никогда не видела, что не критично, так как клиенты все равно остаются, хоть и получают скидку на услуги
        + Отточным клиентам она их не предлоожила 71 раз (False Negative), что достаточно хороший результат, нам важнее добиться минимальной ошибки False Negative, так как компания несет убытки больше именно из за ошибки второго рода, так как клиенты уходят


+ Вывод:

В этом отчете приведены основные этапы работы, а также некоторые тонкости в проведенном анализе, для воспроизводимости и интерпретации работы и дальнейшего использования модели в работе

Было достигнуто достаточно хорошее качество предсказаний и модель будет выполнять свою задачу хорошо, но также есть еще что можно улучшить